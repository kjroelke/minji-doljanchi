---
import AnimalPrintSection from '../components/AnimalPrintSection.astro';
import DoljabiOffcanvas from '../components/DoljabiOffcanvas.astro';
const doljabiOptions = [
	{ value: '', label: 'Choose a Doljabi Item...', disabled: true },
	{ value: 'pencil', label: '‚úèÔ∏è Pencil (Scholar)' },
	{ value: 'money', label: 'üíµ Money (Wealth)' },
	{ value: 'thread', label: 'üßµ Thread (Long Life)' },
	{ value: 'stethoscope', label: 'ü©∫ Stethoscope (Doctor)' },
	{ value: 'microphone', label: 'üé§ Microphone (Performer)' },
	{ value: 'soccer', label: '‚öΩ Soccer Ball (Athlete)' },
	{ value: 'paintbrush', label: 'üñåÔ∏è Paintbrush (Artist)' },
];
---

<AnimalPrintSection
	color='light'
	opacity={0.9}
	id='doljabi'
>
	<div class='row justify-content-center'>
		<div class='col-md-8 text-center'>
			<h2 class='display-2 mb-0'>Predict Min-Ji's Future!</h2>
			<p class='fs-6 fw-bold'>
				Which item will Olivia pick up during the doljabi ceremony?
			</p>
		</div>
	</div>
	<div class='row justify-content-center'>
		<div class='col-md-8'>
			<form
				id='doljabi-form'
				class='text-md-center d-flex flex-column row-gap-3 align-items-center'
			>
				<div class='row row-gap-3 justify-content-center'>
					<div class='col'>
						<input
							type='text'
							class='form-control'
							placeholder='Your Name'
							name='name'
							required
							autocomplete='name'
						/>
					</div>
					<div class='col'>
						<select
							class='form-select'
							name='vote'
							required
						>
							{
								doljabiOptions.map((option) => (
									<option
										value={option.value}
										disabled={option.disabled}
									>
										{option.label}
									</option>
								))
							}
						</select>
					</div>
				</div>
				<div class='col-auto d-flex gap-3'>
					<button
						type='submit'
						class='btn btn-dark'
						id='doljabi-submit-btn'
						style='position: relative; min-width: 100px;'
					>
						Cast Your Vote!
					</button>
					<button
						class='btn btn-primary'
						type='button'
						data-bs-toggle='offcanvas'
						data-bs-target='#doljabiOffcanvas'
						aria-controls='doljabiOffcanvas'
					>
						Wait, what?
					</button>
				</div>
				<DoljabiOffcanvas />
			</form>
			<div
				id='doljabi-form-message'
				class='mt-3'
			>
			</div>
		</div>
		<script>
			const form = document.getElementById('doljabi-form');
			const messageDiv = document.getElementById('doljabi-form-message');
			const submitBtn = document.getElementById('doljabi-submit-btn');

			form?.addEventListener('submit', async (e) => {
				e.preventDefault();
				submitBtn.disabled = true;
				messageDiv.textContent = '';
				const formData = new FormData(form);
				const data = Object.fromEntries(formData.entries());

				try {
					const response = await fetch(
						'https://www.kjroelke.online/wp-json/custom/v1/send-email',
						{
							method: 'POST',
							headers: {
								'Content-Type': 'application/json',
							},
							body: JSON.stringify(data),
						}
					);
					const result = await response.json();
					if (result.success) {
						messageDiv.textContent = 'Thank you for your vote!';
						form.reset();
					} else {
						messageDiv.textContent =
							result.error ||
							'There was an error submitting your vote.';
					}
				} catch (err) {
					messageDiv.textContent =
						'There was an error submitting your vote. Please try again later.';
				} finally {
					submitBtn.disabled = false;
				}
			});
		</script>
	</div>
</AnimalPrintSection>
